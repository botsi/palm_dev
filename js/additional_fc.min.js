function draw_centro_mv_img(e,s){o&&(o=null);var o=document.createElement("canvas");o.width=298,o.height=600;var t=o.getContext("2d");t.drawImage(s,0,0),t.fillStyle="#000",t.strokeStyle="#999",t.font="12px Helvetica";for(var i=0;i<e.length;i++)t.fillText(e[i],32,136+48*i),t.moveTo(32,154+48*i),t.lineTo(o.width-32,154+48*i),t.stroke();return o.toDataURL()}var mergeObjects=function(){for(var e={},s=0;s<arguments.length;s+=1)for(var o=arguments[s],t=Object.keys(o),i=0;i<t.length;i+=1)e[t[i]]=o[t[i]];return e},toggleFullScreen=function(){console.log("vid: "+vid),vid.requestFullscreen?vid.requestFullscreen():vid.mozRequestFullScreen?vid.mozRequestFullScreen():vid.webkitRequestFullScreen&&vid.webkitRequestFullScreen()},shop={fields:{form_firma:"",form_anrede:"",form_vorname:"",form_name:"",form_strasse:"",form_nr:"",form_zusatzzeile:"",form_plz:"",form_ort:"",form_land:"",form_email:"",form_telefon:""},items:[],fillbasket:function(){if(console.log("ifill"),shop.list=document.getElementById("palma_shop"),shop.items.length>0){for(var e=0;e<shop.items.length;e++)for(var s=0;s<shop.list.children.length;s++)0==s?shop.items[e].Artikel.indexOf("Terminanfrage")!=-1&&(shop.list.children[s].children[0].classList.remove("form_check_white"),shop.list.children[s].children[0].classList.add("form_check_blue"),shop.list.children[s].children[1].children[1].value=shop.items[e].Artikel.replace("Terminanfrage für ","")):shop.items[e].Artikel==shop.list.children[s].children[1].innerHTML&&(shop.list.children[s].children[0].classList.remove("form_check_white"),shop.list.children[s].children[0].classList.add("form_check_blue"),shop.list.children[s].children[3].value=shop.items[e].Menge);shop.display()}},valid:!1,preSendData:function(){shop.valid&&(console.log(shop.items,shop.order_total.replace("Meine Bestellung: ","").replace("Versandkosten: ","").replace("Summe: ",""),"order_sum: "+shop.order_sum),loadXMLDoc(mergeObjects(shop.fields,{order_text:shop.order_total.replace("Meine Bestellung: ","").replace("Versandkosten: ","").replace("Summe: ",""),order_sum:shop.order_sum})))},work:function(e){if(e.classList.contains("form_check_white"))e.classList.remove("form_check_white"),e.classList.add("form_check_blue"),""==e.nextSibling.nextSibling.nextSibling.value&&(e.nextSibling.nextSibling.nextSibling.value=1),shop.items.push({Artikel:e.nextSibling.innerHTML,Preis:e.nextSibling.nextSibling.id.slice(2),Menge:e.nextSibling.nextSibling.nextSibling.value}),console.log(shop.items);else{e.classList.remove("form_check_blue"),e.classList.add("form_check_white"),e.nextSibling.nextSibling.nextSibling.value="";for(var s=0;s<shop.items.length;s++)if(shop.items[s].Artikel==e.nextSibling.innerHTML){shop.items.splice(s,1);break}}shop.info(e,0),shop.display()},remote_add:function(e){for(var s=!1,o=0;o<shop.items.length;o++)if(shop.items[o].Artikel==folders[chapter].data[folders[chapter].last_position].name){s=!0;break}s||shop.items.push({Artikel:folders[chapter].data[folders[chapter].last_position].name,Preis:folders[chapter].data[folders[chapter].last_position].epilog.Bestellung[2],Menge:1}),search_nostyle(e)},geonames:function(e,s){get_geonames_array(e,s,function(o){o[2]>0?("number"==e?shop.fields[form_ort]=document.getElementById("form_ort").value=o[1]:o[2]>1?o[3].indexOf(document.getElementById("form_plz").value)==-1&&(shop.fields[form_plz]=document.getElementById("form_plz").value=o[0]):shop.fields[form_plz]=document.getElementById("form_plz").value=o[0],shop.fields[form_land]=document.getElementById("form_land").value="Schweiz"):"number"==e?shop.fields[form_ort]=document.getElementById("form_ort").value="":shop.fields[form_plz]=document.getElementById("form_plz").value="",shop.fields[s.id]=s.value})},user:function(e){if(e.value.indexOf("<")!=-1||e.value.indexOf(">")!=-1||e.value.indexOf("'")!=-1||e.value.indexOf('"')!=-1||e.value.indexOf("(")!=-1||e.value.indexOf(")")!=-1||e.value.indexOf("{")!=-1||e.value.indexOf("}")!=-1||e.value.indexOf("eval")!=-1)return console.log("code!"),shop.fields[e.id]=e.value="",void(shop.valid=!1);switch(e.id){case"form_email":" "==e.value||e.value.indexOf("@")==-1||e.value.indexOf(".")==-1||e.value.length<6||e.value.lastIndexOf(".")+3>e.value.length||e.value.lastIndexOf(".")<e.value.indexOf("@")?(console.log("uncomplete"),shop.fields[e.id]=""):shop.fields[e.id]=e.value;break;case"form_vorname":case"form_name":case"form_strasse":" "==e.value||e.value.length<2?(console.log("uncomplete"),shop.fields[e.id]=""):shop.fields[e.id]=e.value;break;case"form_ort":" "==e.value||e.value.length<2?(console.log("uncomplete"),shop.fields[e.id]=""):shop.geonames("string",e);break;case"form_plz":isNaN(e.value)||e.value.length<4?(console.log("uncomplete plz"),shop.fields[e.id]=""):shop.geonames("number",e);break;default:shop.fields[e.id]=e.value}shop.check_send_but()},check_send_but:function(){""!=shop.fields.form_email&&""!=shop.fields.form_vorname&&""!=shop.fields.form_name&&""!=shop.fields.form_strasse&&""!=shop.fields.form_nr&&""!=shop.fields.form_plz&&""!=shop.fields.form_ort?(shop.send_but.style.cursor="pointer",shop.send_but.style.opacity=1,shop.valid=!0):(shop.send_but.style.cursor="default",shop.send_but.style.opacity=.2,shop.valid=!1)},time:function(e){if(""==e.value){for(var s=0;s<shop.items.length;s++)if(shop.items[s].Artikel.indexOf("Terminanfrage")!=-1){shop.items.splice(s,1);break}return void shop.display()}if(0==shop.items.length)shop.items.push({Artikel:"Terminanfrage für "+e.value,Preis:"x",Menge:"x"});else{for(var o=!1,s=0;s<shop.items.length;s++)if(shop.items[s].Artikel.indexOf("Terminanfrage")!=-1){shop.items[s].Artikel="Terminanfrage für "+e.value,o=!0;break}o||shop.items.push({Artikel:"Terminanfrage für "+e.value,Preis:"x",Menge:"x"})}shop.display()},calc:function(e){if(e.value>20&&(e.value=20),e.value<1||""==e.value){e.previousSibling.previousSibling.previousSibling.classList.remove("form_check_blue"),e.previousSibling.previousSibling.previousSibling.classList.add("form_check_white"),e.value="";for(var s=0;s<shop.items.length;s++)if(shop.items[s].Artikel==e.previousSibling.previousSibling.innerHTML){shop.items.splice(s,1);break}return void shop.display()}if(e.previousSibling.previousSibling.previousSibling.classList.contains("form_check_white")&&(e.previousSibling.previousSibling.previousSibling.classList.remove("form_check_white"),e.previousSibling.previousSibling.previousSibling.classList.add("form_check_blue")),0==shop.items.length)shop.items.push({Artikel:e.previousSibling.previousSibling.innerHTML,Preis:e.previousSibling.id.slice(2),Menge:e.value});else for(var s=0;s<shop.items.length;s++){if(shop.items[s].Artikel==e.previousSibling.previousSibling.innerHTML){shop.items[s].Menge=e.value;break}s==shop.items.length-1&&shop.items.push({Artikel:e.previousSibling.previousSibling.innerHTML,Preis:e.previousSibling.id.slice(2),Menge:e.value})}shop.display()},order_div:"",order_sum:0,order_total:"",display:function(e){if(0==shop.items.length)shop.order_total="",shop.list.classList.contains("palma_shop_open")&&(shop.list.classList.remove("palma_shop_open"),shop.list.classList.add("palma_shop_close"),shop.form.classList.remove("palma_form_open"),shop.form.classList.add("palma_form_close"),shop.list.previousSibling.previousSibling.style.width="auto");else{(shop.list.classList.contains("palma_shop_ini")||shop.list.classList.contains("palma_shop_close"))&&(shop.list.classList.remove("palma_shop_close"),shop.list.classList.remove("palma_shop_ini"),shop.list.classList.add("palma_shop_open"),shop.form.classList.remove("palma_form_close"),shop.form.classList.add("palma_form_open"),shop.list.previousSibling.previousSibling.style.width="50%"),shop.order_total="Ihre Bestellung: <br/>",shop.order_sum=0;for(var s=0;s<shop.items.length;s++)"x"!=shop.items[s].Menge?(shop.order_sum+=parseInt(shop.items[s].Menge*shop.items[s].Preis),shop.order_total+=shop.items[s].Menge+" x "+shop.items[s].Artikel+" à CHF "+shop.items[s].Preis+".00<br/>"):shop.order_total+=shop.items[s].Artikel+"<br/>";shop.order_total+="<hr/>",shop.order_total+=shop.order_sum>0?'Versandkosten: CHF 8.00<span style="float:right;text-align:right;line-height:inherit;margin-right: 4px;">Summe: CHF '+parseInt(shop.order_sum+8)+".00</span><br/>":"<br/>"}if(shop.order_div.innerHTML=shop.order_total,e){shop.items=[];for(var o=0;o<shop.list.children.length;o++)0==o?(shop.list.children[o].children[0].classList.remove("form_check_blue"),shop.list.children[o].children[0].classList.add("form_check_white"),shop.list.children[o].children[1].children[1].value=""):(shop.list.children[o].children[0].classList.remove("form_check_blue"),shop.list.children[o].children[0].classList.add("form_check_white"),shop.list.children[o].children[3].value="");shop.order_div.innerHTML+="... wurde registriert und eine Bestätigungs E-Mail an "+shop.fields.form_email+' versendet. <input onclick="shop.display()" style="background:rgba(141, 170, 212, 1);width: 120px;display: inline-block;cursor:pointer;" type="button" value="Ok" />',shop.inner_fields.style.display="none"}else shop.items.length>0&&(shop.inner_fields.style.display="block")},info_bioutId:"",info_ih:{0:function(e){return e?"hinzufügen":"entfernen"},3:function(){return"Anzahl"},4:function(){return"Link zur Buchbeschreibung"}},info:function(e,s){var o=document.getElementById("found");if(0==s)o.classList.add("bask_info_out"),shop.info_bioutId=setTimeout(function(){o.classList.remove("change_img_in"),o.classList.remove("found_over"),o.classList.remove("bask_info_out"),o.style.top="198px"},300);else{clearTimeout(shop.info_bioutId),o.innerHTML="<a>"+shop.info_ih[getchildindex(e)](e.classList.contains("form_check_white"))+"</a>",o.classList.remove("bask_info_out"),o.classList.add("change_img_in"),o.classList.add("found_over");var t=e.getBoundingClientRect();o.style.left=(t.left+t.right-o.offsetWidth)/2+"px",o.style.top=t.top-40+"px"}}},loadForm=function(){if(console.log("loadForm",shop.items),document.getElementById("palma_form")||console.log("!document.getElementById(palma_form)"),shop.form=document.getElementById("palma_form"),""!=shop.form.innerHTML)return console.log("shop.form.innerHTML != empty ireturn"),shop.check_send_but(),void shop.fillbasket();var e='<form><div id="order_sum"></div><textarea onchange="sh_dat.title_proc(this)" class="proj_title" rows="4" placeholder="Kurzbeschrieb"></textarea><span style="margin: 0;width:180px;display: none;"><input class="proj_vis_underlay" placeholder="PDF Datei" type="text"/><input onchange="sh_dat.file_proc(this)" class="proj_file" type="file"accept=".pdf, application/pdf"/></span><div id="inner_fields"><span><label>Firma</label><input type="text" id="form_firma" name="form_firma"></span><span><label>Anrede</label><select id="form_anrede" name="form_anrede"><option></option><option value="Frau">Frau</option><option value="Herr">Herr</option></select></span><span><label>Vorname</label><input type="text" id="form_vorname" name="form_vorname" class="cap" required></span><span><label>Name</label><input type="text" id="form_name" name="form_name" class="cap" required></span><span class="large prefield"><label>Strasse</label><input type="text" id="form_strasse" name="form_strasse" class="cap" required></span><span class="small"><label>Nr.</label><input type="text" id="form_nr" name="form_nr" required></span><span><label>Zusatzzeile</label><input type="text" id="form_zusatzzeile" name="form_zusatzzeile"></span><span class="small prefield"><label>PLZ</label><input type="text" id="form_plz" name="form_plz" required></span><span class="large"><label>Ort</label><input type="text" id="form_ort" name="form_ort" class="cap" required></span><span><label>Land</label><input type="text" id="form_land" name="form_land" class="cap"></span><span><label>Email</label><input type="email" id="form_email" name="form_email" required></span><span><label>Telefon</label><input type="text" id="form_telefon" name="form_telefon"></span><br></div></form>';shop.form.innerHTML=e,shop.order_div=document.getElementById("order_sum"),shop.send_but=shop.form.parentNode.nextSibling.children[2],shop.inner_fields=document.getElementById("inner_fields"),console.log(shop.form.children[0].elements.length);for(var s=0;s<shop.form.children[0].elements.length-1;s++)shop.form.children[0].elements[s].className.indexOf("proj")==-1&&(shop.form.children[0].elements[s].value=shop.fields[shop.form.children[0].elements[s].id],shop.form.children[0].elements[s].addEventListener("keyup",function(){shop.user(this)},!1));if(shop.check_send_but(),shop.fillbasket(),console.log("need script"),!document.getElementById("geonamesscr")){var o=document.createElement("script");o.onload=function(){console.log("doubleloaded geonamesscr script ???")},o.src="scripts/geonames_dav.js",o.charset="utf-8",o.id="geonamesscr",document.head.appendChild(o)}},map,loadMap=function(){if(document.getElementById("map_script"))return map=null,void initMap();var e=document.createElement("script");e.id="map_script",e.type="text/javascript",e.src="http://maps.google.com/maps/api/js?key=AIzaSyCi0JgwWx4peuLZN6b0Ng2xmW825wMj6tc&callback=initMap",document.body.appendChild(e)},initMap=function(){map=new google.maps.Map(document.getElementById("palma_map"),{center:{lat:46.9583839,lng:7.4461065},mapTypeId:"terrain",scrollwheel:!1,zoom:16})},centro_mv={element:!1,entrys:["museum"],entrys_txt:{museum:["1. Casa Anatta: Eingang","6. Die anarchistische Kolonie"]},controls:function(e,s){this.status=s,this.element=e.parentNode.previousSibling,do_cords(s),this.entrys.indexOf(this.status)==-1&&(e.parentNode.previousSibling.src="mediaguides/monteverita/"+this.status+".png")},cont:function(e){var s=[0,0,document.getElementById("centro-buttons").children[0].offsetWidth,document.getElementById("centro-buttons").children[0].offsetHeight];switch(e){case"home":this[e]={shape:"circle",coords:[.29*s[2]+","+.28*s[3]+","+.1*s[3],s[2]-.29*s[2]+","+.28*s[3]+","+.1*s[3],.5*s[2]+","+.5*s[3]+","+.14*s[3],.29*s[2]+","+(s[3]-.28*s[3])+","+.1*s[3],s[2]-.29*s[2]+","+(s[3]-.28*s[3])+","+.1*s[3]],ih:["centro_mv.controls(this,'center')","centro_mv.controls(this,'history')","centro_mv.controls(this,'guided')","centro_mv.controls(this,'perso')","centro_mv.controls(this,'guestbook')"]};break;case"center":this[e]={shape:"circle",coords:[.15*s[2]+","+.15*s[3]+","+.05*s[3],.29*s[2]+","+.28*s[3]+","+.1*s[3],s[2]-.29*s[2]+","+.28*s[3]+","+.1*s[3],.29*s[2]+","+(s[3]-.28*s[3])+","+.1*s[3],s[2]-.29*s[2]+","+(s[3]-.28*s[3])+","+.1*s[3]],ih:["centro_mv.controls(this,'home')","do_me(app_display_data[app_display_data.act_app].img_ix[2])","do_me(app_display_data[app_display_data.act_app].img_ix[3])","do_me(app_display_data[app_display_data.act_app].img_ix[4])","do_me(app_display_data[app_display_data.act_app].img_ix[5])"]};break;case"history":this[e]={shape:"rect",coords:[.06*s[2]+","+.12*s[3]+","+.25*s[2]+","+.17*s[3],.09*s[2]+","+.2*s[3]+","+.48*s[2]+","+.48*s[3],.52*s[2]+","+.2*s[3]+","+(s[2]-.09*s[2])+","+.48*s[3],.06*s[2]+","+.82*s[3]+","+.25*s[2]+","+.88*s[3]],ih:["centro_mv.controls(this,'home')","centro_mv.controls(this,'guided')","centro_mv.controls(this,'epoches')","centro_mv.controls(this,'home')"]};break;case"guided":this[e]={shape:"rect",coords:[.06*s[2]+","+.12*s[3]+","+.25*s[2]+","+.17*s[3],.09*s[2]+","+.2*s[3]+","+.48*s[2]+","+.48*s[3],.52*s[2]+","+.2*s[3]+","+(s[2]-.09*s[2])+","+.48*s[3],.09*s[2]+","+.5*s[3]+","+.48*s[2]+","+.78*s[3],.52*s[2]+","+.5*s[3]+","+(s[2]-.09*s[2])+","+.78*s[3],.06*s[2]+","+.82*s[3]+","+.25*s[2]+","+.88*s[3]],ih:["centro_mv.controls(this,'home')","centro_mv.controls(this,'museum')","centro_mv.controls(this,'parc')","centro_mv.controls(this,'environs')","centro_mv.controls(this,'szeemann')","centro_mv.controls(this,'home')"]};break;case"perso":this[e]={shape:"circle",coords:[.15*s[2]+","+.15*s[3]+","+.05*s[3],.5*s[2]+","+.75*s[3]+","+.16*s[3]],ih:["centro_mv.controls(this,'home')","centro_mv.controls(this,'home')"]};break;case"guestbook":this[e]={shape:"circle",coords:[s[2]-.1*s[2]+","+.1*s[3]+","+.1*s[3]],ih:["centro_mv.controls(this,'home')"]};break;case"parc":this[e]={shape:"circle",coords:[.15*s[2]+","+.15*s[3]+","+.05*s[3],.84*s[2]+","+.31*s[3]+","+.04*s[3],.15*s[2]+","+.85*s[3]+","+.05*s[3]],ih:["centro_mv.controls(this,'guided')","do_me(app_display_data[app_display_data.act_app].img_ix[6], 'monteverita_3')","centro_mv.controls(this,'home')"]};break;case"epoches":this[e]={shape:"rect",coords:[.06*s[2]+","+.12*s[3]+","+.25*s[2]+","+.17*s[3],.06*s[2]+","+.82*s[3]+","+.25*s[2]+","+.88*s[3]],ih:["centro_mv.controls(this,'history')","centro_mv.controls(this,'home')"]};break;case"museum":this[e]={shape:"rect",coords:[.06*s[2]+","+.12*s[3]+","+.25*s[2]+","+.17*s[3],.06*s[2]+","+.2*s[3]+","+(s[2]-.06*s[2])+","+.25*s[3],.06*s[2]+","+.26*s[3]+","+(s[2]-.06*s[2])+","+.33*s[3]],ih:["centro_mv.controls(this,'guided')","do_me(app_display_data[app_display_data.act_app].img_ix[0], 'monteverita_1')","do_me(app_display_data[app_display_data.act_app].img_ix[1], 'monteverita_2')"]};var o=document.createElement("img");o.src="mediaguides/monteverita/museum.png",o.onload=function(){centro_mv.element.src=draw_centro_mv_img(centro_mv.entrys_txt[centro_mv.status],this)}}},status:"home"},map_sh_me=function(e,s,o){if(1==e){s.style.cursor="pointer";var t=app_display_data[app_display_data.act_app].walk[app_display_data[app_display_data.act_app].state];sh_me(e,t.plc_tx[o],t.needle[o])}else s.style.cursor="default",sh_me(e)},do_cords=function(e){if("monteverita"==folders[chapter].data[folders[chapter].last_position].comp_name){if(document.getElementById("app_centro")){var s=document.getElementById("app_centro");setTimeout(function(){"undefined"==typeof e?(centro_mv.status="home",centro_mv.cont("home")):centro_mv.cont(e),s.innerHTML="";for(var o=0;o<centro_mv[centro_mv.status].ih.length;o++)s.innerHTML+='<area shape="'+centro_mv[centro_mv.status].shape+'" onclick="'+centro_mv[centro_mv.status].ih[o]+'" onmouseover="this.style.cursor = \'pointer\'" onmouseout="this.style.cursor = \'default\'">';for(var o=0;o<centro_mv[centro_mv.status].ih.length;o++)s.children[o].coords=centro_mv[centro_mv.status].coords[o]},500)}}else if(console.log("do_cords maxfrisch"),document.getElementById("app_frisch")){var s=document.getElementById("app_frisch"),o=app_display_data[app_display_data.act_app].walk[app_display_data[app_display_data.act_app].state];console.log("data_left maxfrisch: "+o.left),document.getElementById("map_canvas").children[0].style.marginLeft=o.left+"px",document.getElementById("map_canvas").children[0].style.marginTop=o.top+"px",setTimeout(function(){s.innerHTML="";for(var e=0;e<o.needle.length;e++)s.innerHTML+='<area shape="circle" onclick="do_me('+o.img_ix[e]+", 'maxfrisch_"+parseInt(app_display_data[app_display_data.act_app].state+1)+"_"+parseInt(e+1)+'\')" onmouseover="map_sh_me(1,this,'+e+')" onmouseout="map_sh_me(0,this)">';for(var e=0;e<o.needle.length;e++)s.children[e].coords=o.needle[e][0]+","+o.needle[e][1]+",20"},500)}};